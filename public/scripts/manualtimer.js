function startit(t,e){var i="dotime("+e+")";t.timerId=setInterval(i,233),seed++}function getTime(t){var e=0,i=0;1e3>t?i=t:(e=Math.floor(t/1e3),i=t-1e3*e);for(var n=t.toString(),r=t.length;7>r;r++)n="0"+n;var s=n.length;return n.substring(0,s-3)+"."+n.substring(s-3)}function dotime(t){try{var e;for(var i in timers)if(timers[i].id==t){e=timers[i].start;break}var n=(new Date).getTime()-e,r=getTime(n);$("#timer-"+t).text(r)}catch(s){}}function updateTimes(){for(var t=(new Date).getTime(),e=0;e<timers.length;e++){var i=timers[e],n=(t-i.start)/1e3;$("#timer-"+i.id).text(n.toFixed(3))}}function timerOn(){timingId=setInterval(updateTimes,65),timersAreOn=!0}function timerOff(){clearInterval(timingId),timersAreOn=!1}var socket=io.connect("http://"+window.location.host);socket.emit("join",{stream:"manualtimer",eventId:eventId}),socket.on("reconnecting",function(){$('<div class="msg-reconnect ui-loading ui-loader ui-loader-verbose ui-overlay-shadow ui-body-b ui-corner-all"><span class="ui-icon ui-icon-loading"></span><h1>Reconnecting</h1></div>').css({display:"block",opacity:.96,"margin-left":"0","margin-top":"0",top:100,left:$(window).width()/2-100}).appendTo($.mobile.pageContainer).delay(100)}),socket.on("connect",function(){$(".msg-reconnect").fadeOut(400,function(){$(this).remove()})}),socket.on("reconnect",function(){$(".msg-reconnect").fadeOut(400,function(){$(this).remove()}),socket.emit("join",{stream:"queue",eventId:eventId})}),socket.on("reconnect_failed",function(){$(".msg-reconnect").fadeOut(400,function(){$(this).remove()})});var lastTimer=null,lastSplit=null,timers=[];socket.on("message",function(t){"norun"==t.status?($("#runs").append("<div>[No driver in queue]</div>"),alert("There was no driver queued in the system.")):"success"==t.status&&$("#runs").append("<div>"+t.run.driver.name+"</div>")});var seed=0;$("#btn-start").on("click",function(){var t=(new Date).getTime();socket.emit("manualtimer",{action:"start",stamp:t});var e=seed,i={start:t,id:e,timerId:0};timers.push(i),$("#timers").append('<div id="timer-'+e+'">000.000</div>'),seed++,timersAreOn||timerOn()});var splits=[],timersAreOn=!1,mode="chrono";$("#btn-split").on("click",function(){if(splits.length<timers.length){var t=(new Date).getTime(),e=(t-timers[splits.length].start)/1e3;splits.push(t),socket.emit("manualtimer",{action:"split",splitNum:0,time:e,stamp:t}),$("#splits").append("<div>"+e+"</div>")}else alert("There are no more started timers to split.")}),$("#btn-split2").on("click",function(){alert("TODO")}),$("#btn-reset").on("click",function(){socket.emit("manualtimer",{action:"resetfinish"}),timers.unshift(lastTimer),splits.unshift(lastSplit),$("#timers").prepend('<div id="timer-'+lastTimer.id+'"></div>'),timersAreOn||timerOn()}),$("#btn-clear").on("click",function(){splits=[],timers=[],$("#timers").empty(),socket.emit("manualtimer",{action:"clear"}),timerOff()}),$("#btn-resetstart").on("click",function(){var t=null;timers.length>0&&(timers.length==splits.length&&splits.pop(),t=timers.pop(),$("#timer-"+t.id).remove(),socket.emit("manualtimer",{action:"resetstart"})),0==timers.length&&timerOff()}),$("#btn-stop").on("click",function(){var t=(new Date).getTime(),e=timers.shift();if(void 0!==e){lastTimer=e;var i=splits.shift(),n=0;void 0!==i&&(n=(i-e.start)/1e3,lastSplit=i),clearInterval(e.timerId),$("#timer-"+e.id).remove();var r=t-e.start,s=r/1e3;socket.emit("manualtimer",{action:"finish",time:s,splits:[n],stamp:t});var a=getTime(r);$("#times").append("<div>"+a+"</div>")}else alert("There are no started timers to finish.");0==timers.length&&timerOff()});var timingId=null;