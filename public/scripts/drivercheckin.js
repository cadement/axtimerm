"undefined"==typeof ax&&(ax={});var tid=0;ax.drivercheckin={partClick:function(e){var r=null;for(var a in participants)participants[a]._id==e&&(r=participants[a]);ax.drivercheckin.selectedDriver=e;var i=r.driver.name,n=r.driver.car.description,t=r.axClass.name,c=r.driver.carNumber,l=null;if($("#drivername").text("#"+c+" "+i),$("#driverinfo").text(n),$.mobile.changePage("#page-checkin",{rel:"dialog"}),$("#newcar-year").val(""),$("#newcar-make").val(""),$("#newcar-model").val(""),$("#newcar-color").val(""),$("#newcarnumber").val(""),r.runGroup){var s=$("input[name=drv-rungroup]").prop("checked",!1);$("#drv-rungroup-"+r.runGroup.name).prop("checked",!0),s.checkboxradio("refresh")}var d=$("input[name=drv-role]").prop("checked",!1);$("#drv-role-"+r.workerRole.replace(" ","")).prop("checked",!0),d.checkboxradio("refresh"),$("input[name=drv-station]").prop("checked",!1).checkboxradio("refresh"),t.indexOf("-")>-1&&(l=t.split("-")[0],t=t.split("-")[1]),l?ax.drivercheckin.setRunGroup(null,l):t&&ax.drivercheckin.setRunGroup(t),$("#drv-class").val(t),$("#drv-class").selectmenu("refresh"),$("#drv-paxclass > option").length>0?($("#drv-paxclass").val(l),$("#drv-paxclass").selectmenu("refresh")):$("#box-paxClass").hide()},init:function(){$("#btn-editnumcar").bind("click",function(){$("#box-editnumcar").toggleClass("hideme")}),$("#searchterm").bind("keyup",function(e,r){ax.drivercheckin.filter()}),$(".li-parts").bind("click",function(){var e=$(this).attr("id").split("-")[1];ax.drivercheckin.partClick(e)}),$("input[name=drv-rungroup]").click(function(){var e=$(this).val();selectedRunGroup=e,ax.drivercheckin.changeView()}),$("#btn-dc-savelabel").bind("click",ax.drivercheckin.save),$("#drv-class").on("change",function(){var e=$(this).val(),r=$("#drv-paxclass").val();e&&!r&&ax.drivercheckin.setRunGroup(e)}),$("#drv-paxclass").on("change",function(){var e=$(this).val(),r=$("#drv-class").val();e?ax.drivercheckin.setRunGroup(null,e):r&&ax.drivercheckin.setRunGroup(r)}),$("#btn-dc-save").bind("click",ax.drivercheckin.save),ax.drivercheckin.changeView()},filter:function(){var e,r=$("#searchterm").val(),a=null,i=$("#participants"),n="";if(a=i.children(),r.length>0){for(var t=a.length;t>=0;t--)e=$(a[t]),n=e.data("term")||e.text(),-1==n.toLowerCase().indexOf(r.toLowerCase())&&e.toggleClass("ui-filter-hidepart",!0);a.filter(":not(.ui-filter-hidepart)").toggleClass("ui-screen-hidden",!1),a.filter(".ui-filter-hidepart").toggleClass("ui-screen-hidden",!0).toggleClass("ui-filter-hidepart",!1)}else a.toggleClass("ui-screen-hidden",!1)},save:function(){var e=ax.drivercheckin.selectedDriver,r=$(this).attr("id"),a=$("input[name=drv-station]:checked").val(),i=$("#drv-class").val(),n=$("#drv-paxclass").val(),t=$("input[name=drv-rungroup]:checked").val(),c=$("input[name=drv-role]:checked").val(),l=$("#newcarnumber").val(),s=$("#newcar-year").val(),d=$("#newcar-make").val(),o=$("#newcar-model").val(),p=$("#newcar-color").val();null==t&&(t="");var u=i;n.length>0&&(u=n+"-"+i);var v=null,h=-1;for(var f in participants)participants[f]._id==e&&(v=participants[f],h=f);$.ajax({url:"/api/drivercheckin/"+eventId,type:"POST",dataType:"json",data:{pid:e,runGroup:t,role:c,axclass:u,station:a,newcarnumber:l,newcar:{year:s,make:d,model:o,color:p}},success:function(i){if("success"==i.status){h>-1&&(participants[h].runGroup={name:t,color:t},participants[h].axClass.name=u,$("#li-"+e).find(".lblclass").text(u)),$.mobile.changePage("#page-drivercheckin",{transition:"none",rel:"back"}),$("#li-"+e).attr("data-theme","b").removeClass("ui-btn-up-d").addClass("ui-btn-up-b"),a&&$("#chk-stat-"+a.replace(" ","").replace("#","")).append('<div style="text-align:left;font-size:.8em;"><div style="display:inline-block;width:20px;height:1em;background-color:'+t+';margin-right:8px;"></div><span>'+$("#li-"+e).find(".lblname").text()+"</span></div>");var n=$("#participants").children();if(n.sort(function(e,r){var a=$(e),i=$(r);return a.attr("data-theme")==i.attr("data-theme")?a.attr("data-term")>i.attr("data-term")?1:-1:a.attr("data-theme")<i.attr("data-theme")?1:-1}),$("#participants").append(n),r.indexOf("label")>-1){var c="http://"+window.location.host;c+="/event/"+eventId+"/printlabel/"+ax.drivercheckin.selectedDriver,window.open(c,"printerlabel")}}else alert("Updating the participant failed. "+i.message)}})},selectedDriver:null,changeView:function(){$(".checkin").hide(),$(".rgi-"+selectedRunGroup).show()},searchClassRunGroups:function(e,r){for(var a=classRunGroups.length-1;a>=0;a--){var i=classRunGroups[a];if(r&&i.paxClass==r)return i.runGroup;if(e&&i.baseClass==e)return i.runGroup}return null},setRunGroup:function(e,r){if(classRunGroups.length>0){var a=ax.drivercheckin.searchClassRunGroups(e,r);$("input[name=drv-rungroup]").prop("checked",!1).checkboxradio("refresh"),a&&$("#drv-rungroup-"+a).prop("checked",!0).checkboxradio("refresh")}}},$("#page-drivercheckin").bind("pageinit",function(){ax.drivercheckin.init()});