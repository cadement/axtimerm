var selectedStation=null,selectedSession=1,activeStation=null,selectedCheckinId=null;$(document).bind("pageinit",function(){function e(){$(".checkin").hide(),$(".rgi-"+selectedRunGroup+".ses-"+selectedSession).show()}$(".workerstation").bind("click",function(){var e=$(this).data("station");selectedStation=e,activeStation=$(this);var i=0;$("#currentcheckins").empty().append('<li data-role="list-divider">Currently Checked In</li>'),activeStation.siblings(".rgi-"+selectedRunGroup+".ses-"+selectedSession).each(function(e,t){i++,$("#currentcheckins").append("<li>"+$(t).find(".name").text()+"</li>")}),0==i&&$("#currentcheckins").append("<li>None</li>"),$("#dialog-title").text("Rungroup: "+selectedRunGroup+", session: "+selectedSession)}),$(".btn-sessions").click(function(){var i=parseInt($(this).attr("id").split("-")[2]);selectedSession=i,$(".btn-sessions").removeClass("ui-btn-active"),$(this).addClass("ui-btn-active"),e()}),$(".btn-rungroup").click(function(){var i=$(this).attr("id").split("-")[2];selectedRunGroup=i,$(".btn-rungroup").removeClass("ui-btn-active"),$(this).addClass("ui-btn-active"),e()}),$(".checkin a").bind("click",function(){var e=$(this).data("kid");selectedCheckinId=e,$("#page-confirm").popup("open")}),$("#btn-confirm").bind("click",function(){$.ajax({url:"/api/workercheckin/"+eventId+"/"+selectedCheckinId,type:"DELETE",dataType:"json",success:function(e){"success"==e.status&&($("#ck-"+selectedCheckinId).remove(),selectedCheckinId=null)}})}),e()}),$("#page-driverlist").bind("pageshow",function(){$("#currentcheckins").listview("refresh")}),$("#page-driverlist").bind("pageinit",function(){$("#driverlist li").bind("click",function(){var e=$(this).data("pid");$.ajax({url:"/api/workercheckin/"+eventId,type:"POST",dataType:"json",data:{runGroup:selectedRunGroup,session:selectedSession,station:selectedStation,pid:e},success:function(e){if("success"==e.status){var i='<div id="ck-'+e.item._id+'" style="font-weight:normal" class="checkin rgi-'+e.item.runGroup+" ses-"+e.item.session+'"><a href="#" data-role="button" data-mini="true" data-kid="'+e.item._id+'"><div style="display:inline-block;width:20px;height:1em;background-color:'+e.item.runGroup+';margin-right:8px;"></div><span class="name">'+e.item.session+" - "+e.item.name+"</span></a></div>";activeStation.parent().append(i).trigger("create"),$(".ui-dialog").dialog("close")}else $("#errmsgtxt").text(e.message),$("#errormessage").popup("open")}})})}),$("#page-driverlist").bind("pagehide",function(){selectedStation=null});