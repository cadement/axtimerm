$(function(){function e(){null!=n&&($.mobile.loading("show",{text:"Importing MotorsportReg.com Participants...",textVisible:!0,theme:"a",html:""}),$.ajax({url:"/api/event/"+eventId+"/importmsr",data:{msrUsername:r,msrPassword:t,msrOrgId:i,msrEventId:n},type:"POST",dataType:"json",success:function(e){if(e.success)if($.mobile.loading("hide"),0==e.participants.length)alert("MSR returned no registrations for that event.");else{e.participants.sort(function(e,r){return e.driver.name<r.driver.name?-1:1}),$("#box-events").trigger("collapse"),$("#box-participants").trigger("expand");var r=$("#ul-participants"),t=[];for(var i in e.participants){var n=e.participants[i];t.push('<li><div class="carnumber">'+n.driver.carNumber+"</div><h1>"+n.driver.name+"</h1><p>"+n.axClass.name+"<br/>"+n.driver.car.description+"</p></li>")}r.empty().append(t.join("")),r.listview("refresh")}else $.mobile.loading("hide"),alert("Failed to do import."+e.message)},error:function(){$.mobile.loading("hide"),alert("Error trying to communicate with your AXti.me system.")}}))}var r=null,t=null,i=null,n=null;$("#btn-start").on("click",function(){r=$("#msrusername").val(),t=$("#msrpassword").val(),i=$("#msrorgid").val().replace(" ",""),r.length<2||t.length<2||35!=i.length?alert("Iinvalid input.  All fields are required"):($.mobile.loading("show",{text:"Retrieving MotorsportReg.com Events...",textVisible:!0,theme:"a",html:""}),$.ajax({url:"/api/event/"+eventId+"/msrevents",data:{msrUsername:r,msrPassword:t,msrOrgId:i},dataType:"json",type:"POST",success:function(r){if(r.success){var t=$("#ul-events");if($.mobile.loading("hide"),0==r.events.length)alert("MSR returned no events.  Are you sure you have the correct Organization Id?");else{t.empty(),$("#box-login").trigger("collapse"),$("#box-events").trigger("expand");for(var i in r.events){var a=r.events[i],s=$('<li id="ev||'+a.id+'"><a><h1>'+a.name+"</h1></a></li>").on("click",function(){n=$(this).attr("id").split("||")[1],e()});t.append(s)}t.listview("refresh")}}else $.mobile.loading("hide"),alert("Problems occurred getting a list of MSR events\nPlease check your credentials and Org Id.\n\n"+r.message)},error:function(){$.mobile.loading("hide"),alert("Error trying to communicate with your AXti.me system.")}}))})});