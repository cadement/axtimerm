function genQueueItem(e,i,t){var n=[];n.push('<div id="q-'+i+'" class="q2-item">'),n.push('<div class="q2-btns">'),n.push('<a data-action="up" class="ui-btn ui-shadow ui-btn-corner-all ui-mini ui-btn-inline ui-btn-icon-notext ui-btn-up-c" data-mini="true" data-inline="true" data-role="button" data-icon="arrow-u" data-iconpos="text"><span class="ui-btn-inner"><span class="ui-btn-text"></span><span class="ui-icon ui-icon-arrow-u ui-icon-shadow">&nbsp;</span></span></a>'),n.push('<a data-action="down" data-mini="true" data-inline="true" data-role="button" data-icon="arrow-d" data-iconpos="notext" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-theme="c" title="" class="ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all ui-mini ui-btn-inline ui-btn-icon-notext"><span class="ui-btn-inner"><span class="ui-btn-text"></span><span class="ui-icon ui-icon-arrow-d ui-icon-shadow">&nbsp;</span></span></a>'),n.push('<a data-action="del" data-inline="true" data-role="button" data-icon="delete" data-iconpos="notext" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-theme="c" title="" class="ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all ui-btn-inline ui-btn-icon-notext"><span class="ui-btn-inner"><span class="ui-btn-text"></span><span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span></span></a>'),n.push("</div>"),n.push('<div class="q2-info">'),n.push('<div class="q2-driver">#'+e.driver.carNumber+" "+e.driver.name+"</div>"),n.push('<div class="q2-car">'+e.driver.car.description+"</div>"),n.push("</div>"),n.push("</div>");var a=$(n.join(""));return a.find('a[data-action="up"]').on("click",function(){moveItemUp(i)}),a.find('a[data-action="down"]').on("click",function(){moveItemDown(i)}),a.find('a[data-action="del"]').on("click",function(){var e=parseInt($(this).parent().parent().attr("id").split("-")[1]);socket.emit("delq",queue[e]._id)}),a}function genInsert(e){return'<div id="ins-'+e+'" class="q2-insert"><div class="ui-icon ui-icon-check"></div><span> Insert driver here</span></div>'}function insertClick(){$(".q2-insert").toggleClass("selected",!1);$(this).addClass("selected")}function moveItemUp(e){var i=[];if(e>0){var t=e-1,n=queue[t],a=queue.slice(0);a[t]=a[e],a[e]=n;for(var o=0;o<a.length;o++)i.push({pos:o,runId:a[o]._id.toString()});socket.emit("reordq",i)}}function moveItemDown(e){var i=[];if(e<queue.length-1){var t=e+1,n=queue[t],a=queue.slice(0);a[t]=a[e],a[e]=n;for(var o=0;o<a.length;o++)i.push({pos:o,runId:a[o]._id.toString()});socket.emit("reordq",i)}}function addToQueue(){socket.emit("addq",{carNumber:"",participantId:$(this).attr("id").split("-")[2],position:-1})}function bigPadAdd(e){if(e.length>0){var i=e,t=[];for(var n in participants)participants[n].driver.carNumber.toString()==i.toString()&&t.push(participants[n]);if(0==t.length)socket.emit("addq",{carNumber:i,position:-1}),$("#lbl-carnum").text("Car #"),i="";else if(1==t.length)socket.emit("addq",{carNumber:"",participantId:t[0]._id,position:-1}),$("#lbl-carnum").text("Car #"),i="";else{var a=$("#popup-multi ul").empty();a.append('<li data-role="list-divider">Multiple Drivers with #'+i+"</li>");for(var n in t){var o=t[n],s=$('<li id="multinum-'+o._id+'"><a><h1>'+o.driver.name+"</h1><p>"+o.axClass.name+"</p><p>"+o.driver.car.description+"</p></a></li>").on("click",partClick);a.append(s)}$("#popup-multi").popup("open"),a.listview("refresh")}}}function getInsertPosition(){var e=$(".q2-insert.selected");if(console.log(e),0==e.length)return-1;var i=e.attr("id").split("-")[1];return"e"==i?-1:parseInt(i)}function partClick(){var e=$(this).attr("id").split("-")[1],i=getInsertPosition();-1==i||void 0===queue[i]?position="-1":position=queue[i]._id.toString(),socket.emit("addq",{carNumber:"",participantId:e,position:position}),$(".ui-dialog").dialog("close"),$("#part-search input").val("").trigger("keyup")}function genAllQueueItems(){$("#queueItems").empty(),$(".q2-insert").toggleClass("selected",!1);for(var e=queue.length,i=0;e>i;i++){var t=genQueueItem(queue[i],i);if($("#queueItems").append(t),i+1!==e){var n=$(genInsert(i+1)).on("vclick",insertClick);$("#queueItems").append(n)}}$("#ins-e").toggleClass("selected",!0)}function delQueueItem(e){for(var i=[],t=0;t<queue.length;t++)queue[t]._id.toString()!=e&&i.push(queue[t]);queue=i,genAllQueueItems()}var queue=[],socket=io.connect("http://"+window.location.host);socket.emit("join",{stream:"queue",eventId:eventId}),socket.on("reconnecting",function(){$('<div class="msg-reconnect ui-loading ui-loader ui-loader-verbose ui-overlay-shadow ui-body-b ui-corner-all"><span class="ui-icon ui-icon-loading"></span><h1>Reconnecting</h1></div>').css({display:"block",opacity:.96,"margin-left":"0","margin-top":"0",top:100,left:$(window).width()/2-100}).appendTo($.mobile.pageContainer).delay(100)}),socket.on("connect",function(){$(".msg-reconnect").fadeOut(400,function(){$(this).remove()})}),socket.on("reconnect",function(){$(".msg-reconnect").fadeOut(400,function(){$(this).remove()}),socket.emit("join",{stream:"queue",eventId:eventId})}),socket.on("disconnect",function(){$("#page-reconnect").popup("open")}),socket.on("reconnect_failed",function(){$(".msg-reconnect").fadeOut(400,function(){$(this).remove()})}),socket.on("message",function(e){$('<div class="msg-message ui-loading ui-loader ui-loader-verbose ui-overlay-shadow ui-body-b ui-corner-all"><h1>Message</h1><p>'+e.message+'</p><p><a data-role="button" onclick="$(\'.msg-message\').remove();">Close</a></div>').css({display:"block",opacity:.96,"margin-left":"0","margin-top":"0",top:100,left:$(window).width()/2-100}).appendTo($.mobile.pageContainer).delay(100)}),$(".q2-insert").on("vclick",insertClick),socket.on("regchange",function(e){"add"==e.action||"update"==e.action||"delete"==e.action}),socket.on("initq",function(e){queue=e,genAllQueueItems()}),socket.on("addq",function(e){queue.push(e);var i=queue.length-1,t=$(genInsert(i)).on("click",insertClick);$("#queueItems").append(t);var n=genQueueItem(e.run,i);$("#queueItems").append(n)}),socket.on("delq",function(e){delQueueItem(e)}),socket.on("cones",function(e){});var dialogVisible=!1;$(document).on("keydown",function(e){if(e.which>47&&e.which<58&&!dialogVisible){var i=e.which-48;bigPadNumber+=i.toString();var t=$("#part-search input").val();$("#part-search input").val(t+v).trigger("keyup")}else if(e.which>95&&e.which<106&&!dialogVisible){var i=e.which-96;bigPadNumber+=i.toString(),$("#lbl-carnum").text(bigPadNumber)}else 8!==e.which&&46!==e.which||$(e.target).is("input, textarea")?13!=e.which||dialogVisible||bigPadNumber.length>0&&bigPadAdd():(e.preventDefault(),bigPadNumber=bigPadNumber.substring(0,bigPadNumber.length-1),$("#lbl-carnum").text(bigPadNumber))}),$(".btn-bigpad").on("click",function(){var e=$(this).data("num"),i=$("#part-search input").val();$("#part-search input").val(i+e).trigger("keyup")}),$(".part").on("click",partClick),$("#btn-test").on("click",function(){alert(getInsertPosition())}),$("#page-addcar").bind("pageshow",function(){dialogVisible=!0}),$("#page-addcar").bind("pagehide",function(){dialogVisible=!1}),$("#btn-show").on("click",function(){$("#addcar").toggleClass("hidden");var e=$("#topofaddcar").position().top;$.mobile.silentScroll(e)});