function validateEmail(e){var r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return r.test(e)}function doDelete(e,r){console.log(r),$.ajax({url:"/api/member/"+memberId,type:"POST",data:{updateType:"del"+r,id:e},dataType:"json",success:function(a){a.success?($("#"+r+"-"+e).remove(),member=a.data,0==member.emails.length&&"email"==r?($("#member-emails").append('<li class="none">None</li>'),$("#member-emails").listview("refresh")):0==member.phones.length&&"phone"==r?($("#member-phones").append('<li class="none">None</li>'),$("#member-phones").listview("refresh")):0==member.addresses.length&&"addr"==r?($("#member-addresses").append('<li class="none">None</li>'),$("#member-addresses").listview("refresh")):0==member.sponsors.length&&"sponsor"==r?($("#member-sponsors").append('<li class="none">None</li>'),$("#member-sponsors").listview("refresh")):0==member.cars.length&&"car"==r&&($("#member-cars").append('<li class="none">None</li>'),$("#member-cars").listview("refresh"))):alert("Failed to remove "+r),$("#popup-delconfirm").popup("close")},error:function(e,a,s){alert("Error deleting "+r+": "+a)}})}function showConfirm(e,r){deleteObj.id=e,deleteObj.type=r,$("#popup-delconfirm").popup("open")}var member=null,deleteObj={id:null,type:null};$("#btn-confirmdelete").on("click",function(){doDelete(deleteObj.id,deleteObj.type)}),$("#btn-save-address").on("click",function(){var e=$("#tb-addrtype").val(),r=$("#tb-street").val(),a=$("#tb-city").val(),s=$("#tb-state").val(),o=$("#tb-zip").val(),l=!1;r.length>0&&a.length>0&&s.length>0&&o.length>0?$.ajax({url:"/api/member/"+memberId,type:"POST",dataType:"json",data:{addrType:e,updateType:"addr",street:r,city:a,state:s,zip:o,isEdit:l},success:function(l){if(l.success){member=l.data,$("#member-addresses li.none").remove();for(var n="xxx",m=0;m<member.addresses.length;m++)if(member.addresses[m].street==r&&member.addresses[m].city==a&&member.addresses[m].state==s&&member.addresses[m].zip==o){n=member.addresses[m]._id;break}var t='<li id="addr-'+n+'" data-icon="delete"><a onclick="showConfirm(\''+n+"','addr')\"><h1>"+e+"</h1><p>"+r+"</p><p>"+a+", "+s+" "+o+"</p></a></li>";$("#member-addresses").append(t),$("#member-addresses").listview("refresh"),$("#dlg-addaddress").popup("close"),$("#tb-street").val(""),$("#tb-city").val(""),$("#tb-state").val(""),$("#tb-zip").val("")}else alert(l.message)},error:function(e,r,a){alert("Error saving address: "+r)}}):alert("All fields are required for this address.")}),$("#btn-save-phone").on("click",function(){var e=$("#tb-phonetype").val(),r=$("#tb-phone").val().toString(),a=10===r.match(/\d/g).length;console.log(r.match(/\d/g)),a?$.ajax({url:"/api/member/"+memberId,type:"POST",data:{updateType:"phone",type:e,phone:r},dataType:"json",success:function(a){if(a.success){member=a.data;for(var s="xxx",o=0;o<member.phones.length;o++)if(member.phones[o].number==r){s=member.phones[o]._id;break}$("#member-phones li.none").remove(),$("#member-phones").append('<li id="phone-'+s+'" data-icon="delete"><a onclick="showConfirm(\''+s+"','phone')\"><h1>"+r+"</h1><p>"+e+"</p></a></li>"),$("#member-phones").listview("refresh"),$("#dlg-addphone").popup("close"),$("#tb-phone").val("")}else alert("Failed to save phone")},error:function(e,r,a){alert("Error saving phone number: "+r)}}):alert("Invalid phone number.")}),$("#btn-save-email").on("click",function(){var e=$("#tb-email").val();e.length>5&&validateEmail(e)?$.ajax({url:"/api/member/"+memberId,type:"POST",data:{updateType:"email",email:e},dataType:"json",success:function(r){if(r.success){member=r.data;for(var a="xxx",s=0;s<member.emails.length;s++)if(member.emails[s].address==e){a=member.emails[s]._id,console.log("found email id");break}$("#member-emails li.none").remove(),$("#member-emails").append('<li id="email-'+a+'" data-icon="delete"><a onclick="showConfirm(\''+a+"','email')\">"+e+"</a></li>"),$("#member-emails").listview("refresh"),$("#dlg-addemail").popup("close"),$("#tb-email").val("")}else alert("Failed to save email")},error:function(e,r,a){alert("Error saving email: "+r)}}):alert("Invalid email.")}),$("#btn-save-sponsor").on("click",function(){var e=$("#tb-sponsor").val();e.length>1?$.ajax({url:"/api/member/"+memberId,type:"POST",data:{updateType:"sponsor",sponsor:e},dataType:"json",success:function(r){if(r.success){member=r.data;for(var a="xxx",s=0;s<member.sponsors.length;s++)if(member.sponsors[s].name==e){a=member.sponsors[s]._id,console.log("found sponsor id");break}$("#member-sponsors li.none").remove(),$("#member-sponsors").append('<li id="sponsor-'+a+'" data-icon="delete"><a onclick="showConfirm(\''+a+"','sponsor')\">"+e+"</a></li>"),$("#member-sponsors").listview("refresh"),$("#dlg-addsponsor").popup("close"),$("#tb-sponsor").val("")}else alert("Failed to save sponsor")},error:function(e,r,a){alert("Error saving sponsor: "+r)}}):alert("Invalid sponsor.")}),$("#btn-save-car").on("click",function(){var e=$("#tb-make").val(),r=$("#tb-model").val(),a=$("#tb-color").val(),s=parseInt($("#tb-year").val());e.length>0&&r.length>0&&a.length>0&&s>0?$.ajax({url:"/api/member/"+memberId,type:"POST",dataType:"json",data:{updateType:"car",make:e,model:r,color:a,year:s},success:function(o){if(o.success){member=o.data,$("#member-cars li.none").remove();for(var l="xxx",n=0;n<member.cars.length;n++)if(member.cars[n].make==e&&member.cars[n].model==r&&member.cars[n].color==a&&member.cars[n].year==s){l=member.cars[n]._id;break}var m='<li id="car-'+l+'" data-icon="delete"><a onclick="showConfirm(\''+l+"','car')\"><h1>"+e+" "+r+"</h1><p>"+a+"</p><p>"+s+"</p></a></li>";$("#member-cars").append(m),$("#member-cars").listview("refresh"),$("#dlg-addcar").popup("close"),$("#tb-make").val(""),$("#tb-model").val(""),$("#tb-color").val(""),$("#tb-year").val("")}else alert(o.message)},error:function(e,r,a){alert("Error saving address: "+r)}}):alert("All fields are required for this car.")});