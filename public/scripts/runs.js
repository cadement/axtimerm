function delRunItem(e){$("#runlist li#run-"+e).remove()}function addToRunList(e){var n='<li class="runs" id="run-'+e._id+'" data-run-drivername="'+e.driver.name+'" data-run-rawtime="'+e.rawTime.toFixed(3)+'" data-run-cones="'+e.cones+'" data-run-penalty="'+(e.isDnf?"dnf":e.isOff?"off":e.getsRerun?"rerun":"none")+'"><a><div class="runnumber" style="color:'+e.runGroup.color+'"><span>'+e.runNumber+'</span></div><div class="carnumber" style="right:30% !important">'+e.axClass.name+'</div><div><h3><div class="list-split-50"><span class="run-name">'+e.driver.name+" #"+e.driver.carNumber+"</span><br/><span>"+e.driver.car.description+'</span></div><div class="list-split-49r"><div><span class="run-rawtime">RAW: '+e.rawTime.toFixed(3)+"</span>"+(e.cones>0?' <span class="run-cones" style="color:red;">+'+e.cones+"</span>":"")+'</div><div><span class="run-paxtime">PAX: '+e.paxTime.toFixed(3)+'</span></div></div></h3><div class="ui-li-desc"><div style="float:left;width:50%;">'+e.axClass.name+" ("+e.axClass.index+')</div><div style="float:left;width:49%;text-align:right;">'+(e.isDnf?"<span>DNF</span>":e.getsRerun?"RERUN":e.isOff?"<span>OFF</span>":"")+'</div></div></div><p class="ui-li-count">'+e.driverRunNumber+"</p></a></li>",i=$(n).bind("click",runClickHandler),t=$('#runlist li[id="run-'+e._id+'"]');t.length>0?t.replaceWith(i):$("#runlist").prepend(i)}function runClickHandler(){var e=$(this),n=e.data("run-rawtime"),i=e.data("run-cones"),t=e.data("run-penalty"),a=e.data("run-drivername");selectedRunId=e.attr("id").split("-")[1],console.log("run click "+selectedRunId),$("#editor-title").text("Edit Run: "+a),$("#newtime").val(n),$("#newcones").val(i),$("#radio-pen-"+t).prop("checked",!0),$.mobile.changePage("#dlg-editor",{role:"dialog"}),$('input[name="radio-pen"]').checkboxradio("refresh")}var conesAdvancedMode=!0,selectedRunId=null,socket=io.connect("http://"+window.location.host);socket.emit("join",{stream:"queue",eventId:eventId}),socket.on("reconnecting",function(){$('<div class="msg-reconnect ui-loading ui-loader ui-loader-verbose ui-overlay-shadow ui-body-b ui-corner-all"><span class="ui-icon ui-icon-loading"></span><h1>Reconnecting</h1></div>').css({display:"block",opacity:.96,"margin-left":"0","margin-top":"0",top:100,left:$(window).width()/2-100}).appendTo($.mobile.pageContainer).delay(100)}),socket.on("connect",function(){$(".msg-reconnect").fadeOut(400,function(){$(this).remove()})}),socket.on("reconnect",function(){$(".msg-reconnect").fadeOut(400,function(){$(this).remove()}),socket.emit("join",{stream:"queue",eventId:eventId})}),socket.on("reconnect_failed",function(){$(".msg-reconnect").fadeOut(400,function(){$(this).remove()})}),socket.on("message",function(e){$('<div class="msg-message ui-loading ui-loader ui-loader-verbose ui-overlay-shadow ui-body-b ui-corner-all"><h1>Message</h1><p>'+e.message+"</p><p><a onclick=\"$('.msg-message').remove();\">Close</a></div>").css({display:"block",opacity:.96,"margin-left":"0","margin-top":"0",top:100,left:$(window).width()/2-100}).appendTo($.mobile.pageContainer).delay(100)}),socket.on("initr",function(e){}),socket.on("delr",function(e){console.log("delr"),delRunItem(e),0==$("#runlist li").length&&($("#runlist").append('<li id="run-none"><h3>None</h3></li>'),$("#runlist").listview("refresh"))}),socket.on("addr",function(e){console.log("addR received: "+e.driver.name),$("#run-none").remove(),addToRunList(e),$("#runlist").listview("refresh")}),socket.on("cones",function(e){}),conesAdvancedMode&&socket.on("conesadv",function(e){}),$(document).on("pageinit",function(){}),$(".runs").bind("click",runClickHandler),$(".parts").bind("click",function(){var e=$(this).attr("id").split("-")[1];null!=selectedRunId?(socket.emit("runswapdriver",{runId:selectedRunId,participantId:e}),$(".ui-dialog").dialog("close")):alert("There is no run selected.")}),$("#btn-save").bind("click",function(){var e=$("#newtime").val(),n=$("#newcones").val(),i=$('input[name="radio-pen"]:checked').val(),t=!1;if(""==n)n=0;else try{n=parseInt(n)}catch(a){alert("Invalid cones value."),t=!0}null!=selectedRunId?e>0&&void 0!=i&&!t?(socket.emit("quickchange",{runId:selectedRunId,time:e,cones:n,penalty:i}),selectedRunId=null,$(".ui-dialog").dialog("close")):0==e?alert("Time cannot be 0, enter 9999 is necessary."):alert("Invalid data.  Did you select a penalty, enter a valid time?"):alert("Run not selected")}),$("#btn-delete").bind("click",function(){null!=selectedRunId?(socket.emit("delr",selectedRunId),selectedRunId=null,$(".ui-dialog").dialog("close")):alert("Run not selected")});